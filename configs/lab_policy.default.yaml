policy_name: "HendzelLab"
policy_version: "2026-02-25"
require_override_reason: true

# SHA-256 hashes of role passphrases.
# Set these to sha256(passphrase).hexdigest() values for your lab.
# Leave empty ("") to allow free role switching (useful for development).
role_auth:
  instructor: ""
  research: ""

roles:
  student:
    description: "Undergraduate — guided workflow, locked parameters"
    allowed_recipes: [nuclear_intensity, puncta_counting]
    export: PASS_ONLY
    allow_overrides: false
    allow_manual_segmentation_params: false
    allow_batch_without_preview: false
    allow_raw_mask_export: false
    require_tournament: true
    max_parameter_deviation: 0.0

  instructor:
    description: "Graduate student / postdoc — full access with audit trail"
    allowed_recipes: [nuclear_intensity, puncta_counting, colocalization]
    export: PASS_WARN
    allow_overrides: true
    allow_manual_segmentation_params: true
    allow_batch_without_preview: true
    allow_raw_mask_export: true
    require_tournament: false
    max_parameter_deviation: null

  research:
    description: "PI / senior researcher — unrestricted"
    allowed_recipes: ALL
    export: ALL
    allow_overrides: true
    allow_manual_segmentation_params: true
    allow_batch_without_preview: true
    allow_raw_mask_export: true
    require_tournament: false
    max_parameter_deviation: null

qc_thresholds:
  metadata:
    pixel_size_um_range: [0.01, 5.0]
  saturation:
    max_fraction_global: 0.005
    max_fraction_roi: 0.002
  drift:
    max_pixels: 2.0
  focus:
    max_drop_fraction: 0.4
  snr:
    warn_min: 2.0
    fail_min: 1.2
  segmentation:
    min_objects: 1
    max_objects: 5000
    min_median_area: 20
    max_median_area: 5000

recipes:
  nuclear_intensity:
    locked_params:
      background_method: annulus
      flatfield: off
    student_editable_params:
      - expected_nucleus_diameter_px
    bounds:
      expected_nucleus_diameter_px:
        min: 5
        max: 80
    guardrails:
      min_nuclei_for_export: 30
      max_cv_area_percent: 80
      require_dna_channel_set: true
      max_saturated_fraction: 0.005

  puncta_counting:
    locked_params:
      background_method: rolling_ball
      flatfield: off
    student_editable_params:
      - expected_puncta_diameter_px
    bounds:
      expected_puncta_diameter_px:
        min: 2
        max: 20
    guardrails:
      min_nuclei_for_export: 20
      max_cv_area_percent: 100
      require_dna_channel_set: true
      max_saturated_fraction: 0.005

  colocalization:
    locked_params: {}
    student_editable_params: []
    bounds: {}
    guardrails:
      min_nuclei_for_export: 20
      require_dna_channel_set: true
      max_saturated_fraction: 0.005
